<section class="cars-page card">
  <div class="page-header">
    <div class="title-block">
      <span class="pill">Panel floty</span>
      <div>
        <h2>Samochody</h2>
        <p>Zarządzaj flotą, zmieniaj statusy i dodawaj nowe pojazdy.</p>
      </div>
    </div>
    <div class="header-actions">
      <button type="button" class="btn ghost" (click)="getCars()">Odśwież listę</button>
      <button (click)="openModal()" type="button" class="btn primary">+ Dodaj auto</button>
    </div>
  </div>

  <form class="filters" autocomplete="off">
    <div class="input-shell">
      <label class="input-label" for="searchText">Fraza wyszukiwania</label>
      <input
        id="searchText"
        (keyup)="searchCars()"
        placeholder="np. Tesla, SUV, 150"
        name="searchText"
        #searchText="ngModel"
        [(ngModel)]="searchForm.searchText"
        class="text-input"
        maxlength="20"
        required
        pattern="^[A-ź\s0-9\-]{2,20}$">
      <small class="muted">Filtruje dynamicznie po wybranej kolumnie.</small>
    </div>
    
    <div class="input-shell">
      <label class="input-label" for="column">Szukaj w kolumnie</label>
      <select (change)="searchCars()" class="select-input" name="column" id="column" #column="ngModel" [(ngModel)]="searchForm.column">
        <option value="brand">Marka</option>
        <option value="model">Model</option>
        <option value="price">Cena</option>
      </select>
    </div>

    <div class="filter-actions">
      <button class="btn soft" type="button" (click)="searchCars()">Filtruj</button>
      <button class="btn ghost" type="button" (click)="searchForm.searchText = ''; searchForm.column = 'brand'; searchCars()">Wyczyść</button>
    </div>
  </form>

  <div class="cars-grid">
    @for (car of cars; track car.id; let i = $index) {
      <article class="car-card" [class.is-rented]="car.is_rented == 1" [routerLink]="['/view-car', car.id]">
        <div class="card-top">
          <span class="status-badge" [class.busy]="car.is_rented == 1">
            {{ car.is_rented == 1 ? 'Wypożyczony' : 'Dostępny' }}
          </span>
          <span class="price-tag">{{ car.price }} zł/h</span>
        </div>
        <div class="car-name">
          <h3>{{ car.brand }}</h3>
          <p class="muted">Model: {{ car.model }}</p>
        </div>
        <div class="card-meta">
          <div class="toggle-shell" (click)="clickColumn($event)">
            <span class="muted">Status</span>
            <label class="switch">
              <input
                type="checkbox"
                [checked]="car.is_rented == 1"
                (change)="onChange($event, car.id)">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-actions" (click)="clickColumn($event)">
            <button (click)="openModal('mod', $event, car)" type="button" class="btn soft">Edytuj</button>
            <button (click)="delCar(car.id!, $event)" type="button" class="btn ghost danger">Usuń</button>
          </div>
        </div>
        <div class="meta-footer">
          <span class="muted">Lp. {{ i + 1 }}</span>
          <span class="muted">ID: {{ car.id }}</span>
        </div>
      </article>
    }
  </div>
</section>
